<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="profile.css">
    <!-- JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/c3@0.6.0/c3.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@5.4.0/dist/d3.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/c3@0.6.0/c3.min.js"></script>
</head>
<body>
	<!-- <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#projectCreationModal" >
	Create New Project
</button> -->

<!--Project Creation Modal -->
<div class="modal fade" id="projectCreationModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLongTitle">Add a New Project</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form id="uploadForm" action="/uploadFile" method="post" enctype="multipart/form-data" target="_self">
					<div class="form-group">
						<label for="projectTitle">Name Your Project</label>
						<input name="projectTitle" type="text" class="form-control" id="projectTitle" placeholder="Project Title">
					</div>
					<div class="form-group">
						<label for="projectDescription">What does your project show?</label>
						<input name="projectDescription" type="text" class="form-control" id="projectDescription" placeholder="Project Description">
					</div>
					<div class="form-group">
						<label for="image">Upload Image</label>
						<input type="file" name="image" id="image" class="form-control">
					</div>
					<input type="hidden" name="userId" id="userId">
					<input type="submit" class="btn btn-primary" id="submitProject">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
				</form>
			</div>
		</div>
	</div>
</div>

<!--Project View Modal -->
<div class="modal fade" id="projectViewModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="exampleModalLongTitle"></h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div id="project-view-modal" class="modal-body">
				<img src="" alt="Project Image" class="design-pics img-responsive" id="projectImgModal">
				<p id="projectTitleModal"></p>
				<p id="projectDescriptionModal"></p>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
				<i id="likeButton" class="far fa-heart fa-lg"></i>
			</div>
		</div>
	</div>
</div>


<div class="container-fluid" id="navcontainer">
	<nav class="navbar navbar-expand-lg" id="nav">
		<a class="navbar-brand" href="home.html" id="anchor"><img src="inlook.png" class="img-responsive" alt="brandlogo" id="logoImg"/></a>
		<div class="collapse navbar-collapse" id="navbarSupportedContent">
			<div class="input-group">
				<input type="text" class="form-control" placeholder="Search...">
				<span class="input-group-btn">
					<button class="btn btn-default" type="button"><i class="fas fa-search"></i></button>
				</span>
			</div>
			<ul class="navbar-nav ml-auto">
				<li class="nav-item">
					<a class="nav-link" href="profile.html" id="userName"><i class="fas fa-user-circle"></i> User </a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="messages.html"><i class="far fa-envelope fa-lg"></i></a>
				</li>
				|
				<li class="nav-item">
					<a class="nav-link" href="login.html" id="logout"><i class="fas fa-sign-out-alt"></i></a>
				</li>
			</ul>
		</div>
	</nav>
</div>
<div class="main">



	<!-- main content- bio, profile pic,
	following button, message button, project number, followers/following number-->
	<div class="row" id="sideinfo">
		<div class="col-md-5 col-xs-3">
			<div class="sidebar-profile-info" id="userinfo">
				<!-- Profile essential details -->
				<div class="profile-important">
					<div class="profile-photo">
						<img src="profpic.png"  id="profpic" alt="">
					</div>
					<h3 class="username profileName" id="profileName">User</h3>
					<div class="bio">Hi, My name is <span class="profileName"></span>! Message me if you wanna work together!</div>
					<div class="profile-buttons">
						<button type="button" class="btn-sm-follow" id="followUser">Follow</button>
						<button type="button" class="btn-sm-message" id="messageButton">Message</button>
					</div>
				</div>

				<!-- Skills list -->
				<!-- <div class="sidebar-info-bar"> -->
					<!-- <div class="profile-important"> -->
						<h4>Skills & Styles </h4>
						<ul class="skills-list">
							<li>Modern</li>
							<li>Contemporary</li>
							<li>Rustic</li>
						</ul>
					<!-- </div> -->
					<!-- </div> -->
					<!-- <div class="sidebar-info-bar"> -->
					<!-- <div class="profile-important"> -->
						<h4>Social</h4>
						<div id="socialMedia">
							<a href="wwww.twitter.com" class="fa fa-twitter"></a>
							<a href="wwww.linkedin.com" class="fa fa-linkedin"></a>
							<a href="www.instagram.com" class="fa fa-instagram"></a>
						</div>

					<!-- </div> -->
				<!-- </div> -->
			</div>
		</div>

		<!-- <div class="col-md-7 col-xs-9">
		<div class="project1" id="profileProjects">
		<img class="img-responsive" src="profile_interior.jpg" alt="">
		<img class="img-responsive" src="profile_interior.jpg" alt="">
		<img class="img-responsive" src="profile_interior.jpg" alt="">
		<img class="img-responsive" src="profile_interior.jpg" alt="">
	</div>
</div> -->

<div class="projects-main">
	<button type="button btn-sm" id="createProject" class="btn btn-primary" data-toggle="modal" data-target="#projectCreationModal" >
		<i class="fas fa-plus"></i>
	</button>
	<template class="projectTemplate">
		<div class="project">
			<div class="project-pic">
				<img src="interior_design4.jpg" alt="" class="design-pics img-responsive" id="projectImg">
			</div>
			<p class="projectInfo" id="projectTitle"></p>
			<p class="projectInfo" id="projectDescription"></p>
			<p class="projectInfo" id="projectId"></p>
		</div>
	</template>
</div>
</div>
</div>
<div id="likeChart">
	
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
  let projectClickedId;
  let columns = [];
  let columns1 = ['likes'];
  columns.push(columns1);
  let categories = [];
  
  

$(document).ready(() => {



	// $(document).on('click', 'img', () => {
	//             $('#projectViewModal').modal();
	//           });

      //get userId and store in modal form field
      const userId = sessionStorage.getItem('id');
      //get id of viewed profile
      const profileClickedId = sessionStorage.getItem('profileClickedId');
      console.log("hello" + profileClickedId);
      
      $('#userId').val(userId);
      console.log("userId " + userId);
      const getUserProfileUrl = '/loadProfile/' + profileClickedId;
      console.log(getUserProfileUrl);
      $.ajax({
          url: getUserProfileUrl,
          type: 'GET',
          datatype: 'JSON',
          success: (data) => {
              console.log('Recieved user profile info');
              console.log(data);
              $('#userName')[0].childNodes[1].nodeValue = ' ' + data.firstName + ' ' + data.lastName;
              $('.profileName').html(data.firstName + ' ' + data.lastName);
          }
      });
      const getUserProjectsUrl = '/loadProjects/' + profileClickedId;
      $.ajax({
          url: getUserProjectsUrl,
          type: 'GET',
          datatype: 'JSON',
          success: (data) => {
              //console.log(data);
              if (data[0] != null) {
                const template = document.querySelector('.projectTemplate');
                const projectsMain = document.querySelector('.projects-main');
                for(let i = 0; i < data.length; i++) {
                  template.content.querySelector('.design-pics').src = data[i].mainImg;
                  template.content.querySelector('#projectTitle').textContent = data[i].projectTitle;
                  template.content.querySelector('#projectDescription').textContent = data[i].projectDescription;
                  template.content.querySelector('#projectId').textContent = data[i].projectId;
                  
                  const currentProjectTitle = data[i].projectTitle;
                  //query for how many likes this project has and store in array
                  const getAmountOfLikesUrl = 'getAmountOfLikes/' + data[i].projectId;
                  $.ajax({
                    url: getAmountOfLikesUrl,
                    type: 'GET',
                    datatype: 'JSON',
                    success: (data) => {
                      columns1.push(data.length);
                      categories.push(currentProjectTitle);
                      //console.log(columns);
                      //console.log(categories);
                      var chart = c3.generate({
                            bindto: '#likeChart',
                         data: {
                             columns: columns,
                             type: 'bar'
                         },
                         axis: {
                             x: {
                                 label: {
                                     text: 'projects',
                                     position: 'outer-center'
                                 },
                                 type: 'category',
                                 categories: categories,
                                 tick: {
                                     centered: true
                                 }
                             }
                         },
                         bar: {
                             width: {
                                 ratio: 0.25 // this makes bar width 50% of length between ticks
                             }
                             // or
                             //width: 100 // this makes bar width 100px
                         }
                      });
                    }
                  });


					console.log(data[i].mainImg);
					let clone = document.importNode(template.content, true);
					projectsMain.appendChild(clone);
				}
                
                //data visualization
      
               
              
                
                

			
                $(".design-pics").click(function(event){
                  //project div
                  projectDiv = $(event.target).parent().parent();
                  console.log($(event.target).parent().text());
                  console.log($(event.target).attr("src"));
                  $("#projectImgModal").attr("src", $(event.target).attr("src"));
                  console.log($(projectDiv).find('#projectTitle').text());
                  $('#projectTitleModal').text($(projectDiv).find('#projectTitle').text());
                  $('#projectDescriptionModal').text($(projectDiv).find('#projectDescription').text());
                  
                  //set projectClickedId to projectId of clicked project 
                  projectClickedId = $(projectDiv).find('#projectId').text();
                  
                  //make query to database to determine whether this project was liked by user or not
                  const isProjectLikedUrl = '/isProjectLiked/' + userId + '/' + projectClickedId;
                  $.ajax({
                    url: isProjectLikedUrl,
                    type: 'GET',
                    datatype: 'JSON',
                    success: (data) => {
                      console.log('Checked if disliked or not');
                      //if data exists then project was disliked
                      if (data) {
                        //set appearance of like button to already liked
                        $('#likeButton').removeClass('far').addClass('fas');
                      }
                      else {
                        $('#likeButton').removeClass('fas').addClass('far');
                      }
                      //display modal
                      $('#projectViewModal').modal();
                    }
                  });
                  

                });
              }
          }
      });
    
      //send userId and projectId to database when like button is clicked
      const likeProjectUrl = '/likeProject';
      const dislikeProjectUrl = '/dislikeProject';
      $('#likeButton').click(() => {
      	if($('#likeButton').hasClass('fas')){
            $.ajax({
              url: dislikeProjectUrl,
              type: 'POST',
              datatype: 'JSON',
              data: {
                userId: userId,
                projectId: projectClickedId
              },
              success: (data) => {
                console.log('disliked');
                $('#likeButton').removeClass('fas').addClass('far');
              }
            });
      	} else {
      		$.ajax({
      			url: likeProjectUrl,
      			type: 'POST',
      			datatype: 'JSON',
      			data: {
      				userId: userId,
      				projectId: projectClickedId
      			},
      			success: (data) => {
            	//change appearance of like button
            	console.log('Liked');
            	$('#likeButton').removeClass('far').addClass('fas');
        		}
    		});
      	}
      });
    
      //send userId's to database when follow button is clicked
      const followPersonUrl = '/followPerson';
      $('#followUser').click(() => {
        $.ajax({
          url: followPersonUrl,
          type: 'POST',
          datatype: 'JSON',
          data: {
            userFollowingId: userId,
            userFollowedId: profileClickedId
          },
          success: (data) => {
            //change appearance of follow button
            console.log('Follow button should change now');
          }
        });
      });
      document.querySelector('#projectTitleModal').text = "Hello";
      $('#logout').click(() => {
          sessionStorage.clear();
          console.log(sessionStorage.getItem('id'));
      });
  
      const getProjectsAndLikesUrl = '/getProjectsAndLikes/' + userId 
      $.ajax({
        url: getProjectsAndLikesUrl,
        type: 'GET',
        datatype: 'JSON',
        success: (data) => {
          console.log("hello");
          console.log(data);
        }
      });
      
      $('#messageButton').click((event) => {
        const createNewConversationUrl = '/createNewConversation'
        $.ajax({
          url: createNewConversationUrl,
          type: 'POST',
          datatype: 'JSON',
          data: {
            userId: userId,
            profileClickedId: profileClickedId
          },
          success: (data) => {
            
          }
        });
      });
      
  });


</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
</body>
</html>
